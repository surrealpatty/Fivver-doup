{"version":3,"sources":["../../../src/controllers/authController.ts"],"sourcesContent":["import { Request, Response } from 'express'; // Make sure you import Response\r\nimport bcrypt from 'bcryptjs'; // Ensure consistent import\r\nimport jwt from 'jsonwebtoken';\r\nimport { User } from '../models/user';\r\n\r\n// User Registration\r\nexport const registerUser = async (req: Request, res: Response): Promise<Response> => {\r\n  const { email, username, password } = req.body;\r\n\r\n  try {\r\n    // Input validation\r\n    if (!email || !username || !password) {\r\n      return res.status(400).json({ message: 'Please provide all fields' });\r\n    }\r\n\r\n    // Check if user already exists by email\r\n    const existingUser = await User.findOne({ where: { email } });\r\n    if (existingUser) {\r\n      return res.status(400).json({ message: 'User already exists' });\r\n    }\r\n\r\n    // Hash the password before saving it\r\n    const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n    // Create a new user\r\n    const user = await User.create({ email, username, password: hashedPassword });\r\n\r\n    // Send success response with user data (excluding password for security)\r\n    return res.status(201).json({\r\n      message: 'User created successfully',\r\n      user: { id: user.id, email: user.email, username: user.username },\r\n    });\r\n  } catch (error) {\r\n    console.error('Error during user registration:', error);\r\n    return res.status(500).json({ message: 'Server error during user registration' });\r\n  }\r\n};\r\n\r\n// User Login\r\nexport const loginUser = async (req: Request, res: Response): Promise<Response> => {\r\n  const { email, password } = req.body;\r\n\r\n  try {\r\n    // Input validation\r\n    if (!email || !password) {\r\n      return res.status(400).json({ message: 'Please provide email and password' });\r\n    }\r\n\r\n    // Check if the user exists by email\r\n    const user = await User.findOne({ where: { email } });\r\n    if (!user) {\r\n      return res.status(400).json({ message: 'Invalid email or password' });\r\n    }\r\n\r\n    // Compare the password with the hashed password\r\n    const isMatch = await bcrypt.compare(password, user.password);\r\n    if (!isMatch) {\r\n      return res.status(400).json({ message: 'Invalid email or password' });\r\n    }\r\n\r\n    // Generate a JWT token (use environment variable for secret key)\r\n    const token = jwt.sign(\r\n      { id: user.id, email: user.email, username: user.username },\r\n      process.env.JWT_SECRET || 'your-default-secret', // Use a default secret if not set\r\n      { expiresIn: '1h' } // Token expiration time\r\n    );\r\n\r\n    // Send the token in the response\r\n    return res.status(200).json({\r\n      message: 'Login successful',\r\n      token, // Send JWT token to the user\r\n    });\r\n  } catch (error) {\r\n    console.error('Error during login:', error);\r\n    return res.status(500).json({ message: 'Server error during login' });\r\n  }\r\n};\r\n"],"names":["loginUser","registerUser","req","res","email","username","password","body","status","json","message","existingUser","User","findOne","where","hashedPassword","bcrypt","hash","user","create","id","error","console","isMatch","compare","token","jwt","sign","process","env","JWT_SECRET","expiresIn"],"mappings":";;;;;;;;;;;IAuCaA,SAAS;eAATA;;IAjCAC,YAAY;eAAZA;;;iEALM;qEACH;sBACK;;;;;;AAGd,MAAMA,eAAe,OAAOC,KAAcC;IAC/C,MAAM,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAE,GAAGJ,IAAIK,IAAI;IAE9C,IAAI;QACF,mBAAmB;QACnB,IAAI,CAACH,SAAS,CAACC,YAAY,CAACC,UAAU;YACpC,OAAOH,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAA4B;QACrE;QAEA,wCAAwC;QACxC,MAAMC,eAAe,MAAMC,UAAI,CAACC,OAAO,CAAC;YAAEC,OAAO;gBAAEV;YAAM;QAAE;QAC3D,IAAIO,cAAc;YAChB,OAAOR,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAAsB;QAC/D;QAEA,qCAAqC;QACrC,MAAMK,iBAAiB,MAAMC,iBAAM,CAACC,IAAI,CAACX,UAAU;QAEnD,oBAAoB;QACpB,MAAMY,OAAO,MAAMN,UAAI,CAACO,MAAM,CAAC;YAAEf;YAAOC;YAAUC,UAAUS;QAAe;QAE3E,yEAAyE;QACzE,OAAOZ,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;YAC1BC,SAAS;YACTQ,MAAM;gBAAEE,IAAIF,KAAKE,EAAE;gBAAEhB,OAAOc,KAAKd,KAAK;gBAAEC,UAAUa,KAAKb,QAAQ;YAAC;QAClE;IACF,EAAE,OAAOgB,OAAO;QACdC,QAAQD,KAAK,CAAC,mCAAmCA;QACjD,OAAOlB,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;QAAwC;IACjF;AACF;AAGO,MAAMV,YAAY,OAAOE,KAAcC;IAC5C,MAAM,EAAEC,KAAK,EAAEE,QAAQ,EAAE,GAAGJ,IAAIK,IAAI;IAEpC,IAAI;QACF,mBAAmB;QACnB,IAAI,CAACH,SAAS,CAACE,UAAU;YACvB,OAAOH,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAAoC;QAC7E;QAEA,oCAAoC;QACpC,MAAMQ,OAAO,MAAMN,UAAI,CAACC,OAAO,CAAC;YAAEC,OAAO;gBAAEV;YAAM;QAAE;QACnD,IAAI,CAACc,MAAM;YACT,OAAOf,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAA4B;QACrE;QAEA,gDAAgD;QAChD,MAAMa,UAAU,MAAMP,iBAAM,CAACQ,OAAO,CAAClB,UAAUY,KAAKZ,QAAQ;QAC5D,IAAI,CAACiB,SAAS;YACZ,OAAOpB,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAA4B;QACrE;QAEA,iEAAiE;QACjE,MAAMe,QAAQC,qBAAG,CAACC,IAAI,CACpB;YAAEP,IAAIF,KAAKE,EAAE;YAAEhB,OAAOc,KAAKd,KAAK;YAAEC,UAAUa,KAAKb,QAAQ;QAAC,GAC1DuB,QAAQC,GAAG,CAACC,UAAU,IAAI,uBAC1B;YAAEC,WAAW;QAAK,EAAE,wBAAwB;;QAG9C,iCAAiC;QACjC,OAAO5B,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;YAC1BC,SAAS;YACTe;QACF;IACF,EAAE,OAAOJ,OAAO;QACdC,QAAQD,KAAK,CAAC,uBAAuBA;QACrC,OAAOlB,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;QAA4B;IACrE;AACF"}