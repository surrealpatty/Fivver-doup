{"version":3,"sources":["../../src/api.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport jwt, { JwtPayload } from 'jsonwebtoken';\r\n\r\n// Define the expected structure of the decoded JWT payload\r\ninterface UserPayload extends JwtPayload {\r\n  id: string;\r\n  email: string;\r\n  username: string;\r\n  tier: \"free\" | \"paid\";  // Changed 'string' to '\"free\" | \"paid\"'\r\n}\r\n\r\n// Augment the Request interface to include the `user` property\r\ndeclare module 'express-serve-static-core' {\r\n  interface Request {\r\n    user?: UserPayload;\r\n  }\r\n}\r\n\r\n// Middleware to authenticate the token\r\nexport const authenticateToken = (\r\n  req: Request,\r\n  res: Response,\r\n  next: NextFunction\r\n): Response<any, Record<string, any>> | void => {\r\n  try {\r\n    const authorizationHeader = req.headers['authorization'];\r\n\r\n    if (!authorizationHeader || !authorizationHeader.startsWith('Bearer ')) {\r\n      return res.status(401).json({ message: 'Authorization token is missing or invalid' });\r\n    }\r\n\r\n    const token = authorizationHeader.split(' ')[1];\r\n\r\n    if (!token) {\r\n      return res.status(401).json({ message: 'Authorization token is missing' });\r\n    }\r\n\r\n    const jwtSecret = process.env.JWT_SECRET;\r\n    if (!jwtSecret) {\r\n      console.error('JWT_SECRET is not configured in the environment variables');\r\n      return res.status(500).json({ message: 'Internal server error' });\r\n    }\r\n\r\n    const decoded = jwt.verify(token, jwtSecret) as UserPayload;\r\n\r\n    req.user = decoded;\r\n    next();\r\n  } catch (error) {\r\n    console.error('Token authentication failed:', error);\r\n    return res.status(403).json({ message: 'Invalid or expired token' });\r\n  }\r\n};\r\n"],"names":["authenticateToken","req","res","next","authorizationHeader","headers","startsWith","status","json","message","token","split","jwtSecret","process","env","JWT_SECRET","console","error","decoded","jwt","verify","user"],"mappings":";;;;+BAmBaA;;;eAAAA;;;qEAlBmB;;;;;;AAkBzB,MAAMA,oBAAoB,CAC/BC,KACAC,KACAC;IAEA,IAAI;QACF,MAAMC,sBAAsBH,IAAII,OAAO,CAAC,gBAAgB;QAExD,IAAI,CAACD,uBAAuB,CAACA,oBAAoBE,UAAU,CAAC,YAAY;YACtE,OAAOJ,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAA4C;QACrF;QAEA,MAAMC,QAAQN,oBAAoBO,KAAK,CAAC,IAAI,CAAC,EAAE;QAE/C,IAAI,CAACD,OAAO;YACV,OAAOR,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAAiC;QAC1E;QAEA,MAAMG,YAAYC,QAAQC,GAAG,CAACC,UAAU;QACxC,IAAI,CAACH,WAAW;YACdI,QAAQC,KAAK,CAAC;YACd,OAAOf,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAAwB;QACjE;QAEA,MAAMS,UAAUC,qBAAG,CAACC,MAAM,CAACV,OAAOE;QAElCX,IAAIoB,IAAI,GAAGH;QACXf;IACF,EAAE,OAAOc,OAAO;QACdD,QAAQC,KAAK,CAAC,gCAAgCA;QAC9C,OAAOf,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;QAA2B;IACpE;AACF"}