{"version":3,"sources":["../../../src/middlewares/authMiddleware.ts"],"sourcesContent":["// src/middlewares/authMiddleware.ts\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport jwt from 'jsonwebtoken';\r\nimport { AuthRequest } from '../types';  // Correct import for AuthRequest\r\nimport { UserPayload } from '../types';  // Correct import for UserPayload\r\n\r\n// Secret key for JWT verification, you should store it in an environment variable for security\r\nconst SECRET_KEY = process.env.JWT_SECRET_KEY || 'your-secret-key'; // Replace with your actual secret key\r\n\r\n// Middleware to check if the user is authenticated\r\nexport const checkAuth = (\r\n  req: AuthRequest,  // Use the correct type here\r\n  res: Response,\r\n  next: NextFunction\r\n): void => {\r\n  const token = req.headers['authorization']?.split(' ')[1]; // Assuming token is passed as \"Bearer token\"\r\n\r\n  if (!token) {\r\n    return res.status(401).json({ message: 'Authorization token is missing' });\r\n  }\r\n\r\n  try {\r\n    // Verify the token\r\n    const decoded = jwt.verify(token, SECRET_KEY) as UserPayload;\r\n\r\n    // Attach user information to the request object for further use in the route\r\n    req.user = decoded;\r\n\r\n    // Proceed to the next middleware or route handler\r\n    next();\r\n  } catch (error) {\r\n    return res.status(401).json({ message: 'Invalid or expired token' });\r\n  }\r\n};\r\n"],"names":["checkAuth","SECRET_KEY","process","env","JWT_SECRET_KEY","req","res","next","token","headers","split","status","json","message","decoded","jwt","verify","user","error"],"mappings":"AAAA,oCAAoC;;;;;+BAUvBA;;;eAAAA;;;qEARG;;;;;;AAIhB,+FAA+F;AAC/F,MAAMC,aAAaC,QAAQC,GAAG,CAACC,cAAc,IAAI,mBAAmB,sCAAsC;AAGnG,MAAMJ,YAAY,CACvBK,KACAC,KACAC;IAEA,MAAMC,QAAQH,IAAII,OAAO,CAAC,gBAAgB,EAAEC,MAAM,IAAI,CAAC,EAAE,EAAE,6CAA6C;IAExG,IAAI,CAACF,OAAO;QACV,OAAOF,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;QAAiC;IAC1E;IAEA,IAAI;QACF,mBAAmB;QACnB,MAAMC,UAAUC,qBAAG,CAACC,MAAM,CAACR,OAAOP;QAElC,6EAA6E;QAC7EI,IAAIY,IAAI,GAAGH;QAEX,kDAAkD;QAClDP;IACF,EAAE,OAAOW,OAAO;QACd,OAAOZ,IAAIK,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;QAA2B;IACpE;AACF"}