{"version":3,"sources":["../../../src/middlewares/authMiddleware.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport { AuthRequest } from '../types/authMiddleware';  // Importing AuthRequest type\r\n\r\nexport const authenticateJWT = (req: AuthRequest, res: Response, next: NextFunction): void => {\r\n  const token = req.headers.authorization?.split(' ')[1];\r\n\r\n  if (!token) {\r\n    res.status(401).json({ message: 'Unauthorized' });  // Send response directly, no return needed\r\n    return;  // Terminate the function, no need to return anything\r\n  }\r\n\r\n  jwt.verify(token, process.env.JWT_SECRET || '', (err, user) => {\r\n    if (err) {\r\n      res.status(403).json({ message: 'Forbidden' });  // Send response directly, no return needed\r\n      return;  // Terminate the function, no need to return anything\r\n    }\r\n\r\n    if (user) {\r\n      // Cast the 'user' to match our UserPayload interface\r\n      const userPayload = {\r\n        id: (user as any).id,  // Explicit cast here to access 'id' and other fields\r\n        email: (user as any).email,\r\n        username: (user as any).username,\r\n        tier: (user as any).tier, // Ensure 'tier' is available\r\n      };\r\n      \r\n      req.user = userPayload;  // Attach user info to req.user\r\n    }\r\n    \r\n    next();  // Proceed to next middleware\r\n  });\r\n};\r\n"],"names":["authenticateJWT","req","res","next","token","headers","authorization","split","status","json","message","jwt","verify","process","env","JWT_SECRET","err","user","userPayload","id","email","username","tier"],"mappings":";;;;+BAIaA;;;eAAAA;;;qEAJG;;;;;;AAIT,MAAMA,kBAAkB,CAACC,KAAkBC,KAAeC;IAC/D,MAAMC,QAAQH,IAAII,OAAO,CAACC,aAAa,EAAEC,MAAM,IAAI,CAAC,EAAE;IAEtD,IAAI,CAACH,OAAO;QACVF,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;QAAe,IAAK,2CAA2C;QAC/F,QAAS,qDAAqD;IAChE;IAEAC,qBAAG,CAACC,MAAM,CAACR,OAAOS,QAAQC,GAAG,CAACC,UAAU,IAAI,IAAI,CAACC,KAAKC;QACpD,IAAID,KAAK;YACPd,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,SAAS;YAAY,IAAK,2CAA2C;YAC5F,QAAS,qDAAqD;QAChE;QAEA,IAAIO,MAAM;YACR,qDAAqD;YACrD,MAAMC,cAAc;gBAClBC,IAAI,AAACF,KAAaE,EAAE;gBACpBC,OAAO,AAACH,KAAaG,KAAK;gBAC1BC,UAAU,AAACJ,KAAaI,QAAQ;gBAChCC,MAAM,AAACL,KAAaK,IAAI;YAC1B;YAEArB,IAAIgB,IAAI,GAAGC,aAAc,+BAA+B;QAC1D;QAEAf,QAAS,6BAA6B;IACxC;AACF"}